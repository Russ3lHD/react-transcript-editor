(this.webpackChunkpmacom_react_transcript_editor=this.webpackChunkpmacom_react_transcript_editor||[]).push([[157],{927:()=>{const t=e=>e.reduce((e,r)=>e.concat(Array.isArray(r)?t(r):r),[]),e=(t,e)=>{let r=0;return t.map(t=>{const n={start:t.start,end:t.end,confidence:t.confidence,text:t[e],offset:r,length:t[e].length,key:Math.random().toString(36).substring(6)};return r=r+t[e].length+1,n})},r=e=>{const r=e.map(t=>t.entityRanges),n=t(r),s={};return n.forEach(t=>{s[t.key]={type:"WORD",mutability:"MUTABLE",data:t}}),s},n=t=>{if(null==t)return;const e="string"==typeof t?parseFloat(t):t;return Number.isFinite(e)?e:void 0},s=(t,s,a)=>{let o;switch(s){case"whisper":o=((t,r)=>{const s=(t=>t?Array.isArray(t)?t:Array.isArray(t.segments)?t.segments:t.results&&Array.isArray(t.results.segments)?t.results.segments:[]:[])(t),a=s.length,o=s.map((t,s)=>{var o;!r||s%100!=0&&s!==a-1||r({type:"progress",current:s+1,total:a,percentage:Math.round((s+1)/a*100)});const l=((t,e)=>{var r,s,a,o,l;if(Array.isArray(t.words)&&t.words.length>0)return t.words.map(e=>{var r,s,a,o,l,d,i,c,p,u,g,y;const f=(null!==(r=null!==(s=e.word)&&void 0!==s?s:e.text)&&void 0!==r?r:"").toString().trim();if(!f)return null;const w=null!==(a=null!==(o=n(e.start))&&void 0!==o?o:n(e.start_time))&&void 0!==a?a:n(t.start),h=null!==(l=null!==(d=null!==(i=n(e.end))&&void 0!==i?i:n(e.end_time))&&void 0!==d?d:w)&&void 0!==l?l:n(t.end),k=null!==(c=null!==(p=n(e.probability))&&void 0!==p?p:n(e.confidence))&&void 0!==c?c:n(t.confidence);return{start:null!=w?w:0,end:null!==(u=null!=h?h:w)&&void 0!==u?u:0,confidence:null!=k?k:void 0,punct:f,word:f,text:f,speaker:null!==(g=null!==(y=e.speaker)&&void 0!==y?y:e.speaker_label)&&void 0!==g?g:t.speaker_label}}).filter(Boolean);const d=(null!==(r=t.text)&&void 0!==r?r:"").trim();if(!d)return[];const i=null!==(s=n(t.start))&&void 0!==s?s:0;return[{start:i,end:null!==(a=n(t.end))&&void 0!==a?a:i,confidence:null!==(o=n(t.confidence))&&void 0!==o?o:void 0,punct:d,word:d,text:d,speaker:null!==(l=t.speaker_label)&&void 0!==l?l:"TBC ".concat(e)}]})(t,s);if(!l.length)return null;const d=l.map(t=>t.punct).join(" ").trim(),i=null!==(o=l[0].start)&&void 0!==o?o:0;return{text:d,type:"paragraph",data:{speaker:t.speaker_label&&t.speaker_label.trim()||l[0].speaker&&l[0].speaker.trim()||"TBC ".concat(s),words:l,start:i},entityRanges:e(l,"punct")}}).filter(Boolean),l=[];for(let t=0;t<o.length;t++){const r=o[t];if(0===l.length||l[l.length-1].data.speaker!==r.data.speaker)l.push(r);else{const t=l[l.length-1];t.text="".concat(t.text," ").concat(r.text),t.data.words=[...t.data.words,...r.data.words],t.entityRanges=e(t.data.words,"punct")}}return l})(t,a);break;case"bbckaldi":o=((t,r)=>{if(!t||!Array.isArray(t.words))return[];const n=t.words,s=n.length,a=[];let o={words:[],speaker:null};return n.forEach((t,e)=>{r&&e%500==0&&r({type:"progress",current:e+1,total:s,percentage:Math.round((e+1)/s*100)});const n=t.speaker||"Unknown";o.speaker!==n&&o.words.length>0&&(a.push(o),o={words:[],speaker:n}),o.speaker=n,o.words.push({start:t.start,end:t.end,confidence:t.confidence,punct:t.word,word:t.word,text:t.word})}),o.words.length>0&&a.push(o),a.map(t=>({text:t.words.map(t=>t.punct).join(" "),type:"paragraph",data:{speaker:t.speaker,words:t.words,start:t.words[0].start},entityRanges:e(t.words,"punct")}))})(t,a);break;case"draftjs":return t;default:throw new Error("Unsupported STT format: ".concat(s))}return{blocks:o,entityMap:r(o)}};self.onmessage=function(t){const{id:e,type:r,data:n}=t.data;try{if("convert"===r){const{transcriptData:t,sttJsonType:r}=n,a=s(t,r,t=>{self.postMessage({id:e,type:"progress",data:t})});self.postMessage({id:e,type:"complete",data:a})}}catch(t){self.postMessage({id:e,type:"error",error:{message:t.message,stack:t.stack}})}},self.postMessage({type:"ready"})}}]);