(this.webpackChunkpmacom_react_transcript_editor=this.webpackChunkpmacom_react_transcript_editor||[]).push([[157],{6922:()=>{const e=t=>t.reduce((t,r)=>t.concat(Array.isArray(r)?e(r):r),[]),t=(e,t)=>{let r=0;return e.map(e=>{const s={start:e.start,end:e.end,confidence:e.confidence,text:e[t],offset:r,length:e[t].length,key:Math.random().toString(36).substring(6)};return r=r+e[t].length+1,s})},r=t=>{const r=t.map(e=>e.entityRanges),s=e(r),a={};return s.forEach(e=>{a[e.key]={type:"WORD",mutability:"MUTABLE",data:e}}),a},s=e=>{if(null==e)return;const t="string"==typeof e?parseFloat(e):e;return Number.isFinite(t)?t:void 0},a=(e,a,n)=>{let o;switch(a){case"whisper":o=((e,r)=>{const a=(e=>e?Array.isArray(e)?e:Array.isArray(e.segments)?e.segments:e.results&&Array.isArray(e.results.segments)?e.results.segments:[]:[])(e),n=a.length,o=a.map((e,a)=>{!r||a%100!=0&&a!==n-1||r({type:"progress",current:a+1,total:n,percentage:Math.round((a+1)/n*100)});const o=((e,t)=>{if(Array.isArray(e.words)&&e.words.length>0)return e.words.map(t=>{const r=(t.word??t.text??"").toString().trim();if(!r)return null;const a=s(t.start)??s(t.start_time)??s(e.start);return{start:a??0,end:s(t.end)??s(t.end_time)??a??s(e.end)??a??0,confidence:s(t.probability)??s(t.confidence)??s(e.confidence)??void 0,punct:r,word:r,text:r,speaker:t.speaker??t.speaker_label??e.speaker_label}}).filter(Boolean);const r=(e.text??"").trim();if(!r)return[];const a=s(e.start)??0;return[{start:a,end:s(e.end)??a,confidence:s(e.confidence)??void 0,punct:r,word:r,text:r,speaker:e.speaker_label??`TBC ${t}`}]})(e,a);if(!o.length)return null;const p=o.map(e=>e.punct).join(" ").trim(),d=o[0].start??0;return{text:p,type:"paragraph",data:{speaker:e.speaker_label&&e.speaker_label.trim()||o[0].speaker&&o[0].speaker.trim()||`TBC ${a}`,words:o,start:d},entityRanges:t(o,"punct")}}).filter(Boolean),p=[];for(let e=0;e<o.length;e++){const r=o[e];if(0===p.length||p[p.length-1].data.speaker!==r.data.speaker)p.push(r);else{const e=p[p.length-1];e.text=e.text+" "+r.text,e.data.words=[...e.data.words,...r.data.words],e.entityRanges=t(e.data.words,"punct")}}return p})(e,n);break;case"bbckaldi":o=((e,r)=>{if(!e||!Array.isArray(e.words))return[];const s=e.words,a=s.length,n=[];let o={words:[],speaker:null};return s.forEach((e,t)=>{r&&t%500==0&&r({type:"progress",current:t+1,total:a,percentage:Math.round((t+1)/a*100)});const s=e.speaker||"Unknown";o.speaker!==s&&o.words.length>0&&(n.push(o),o={words:[],speaker:s}),o.speaker=s,o.words.push({start:e.start,end:e.end,confidence:e.confidence,punct:e.word,word:e.word,text:e.word})}),o.words.length>0&&n.push(o),n.map(e=>({text:e.words.map(e=>e.punct).join(" "),type:"paragraph",data:{speaker:e.speaker,words:e.words,start:e.words[0].start},entityRanges:t(e.words,"punct")}))})(e,n);break;case"draftjs":return e;default:throw new Error(`Unsupported STT format: ${a}`)}return{blocks:o,entityMap:r(o)}};self.onmessage=function(e){const{id:t,type:r,data:s}=e.data;try{if("convert"===r){const{transcriptData:e,sttJsonType:r}=s,n=a(e,r,e=>{self.postMessage({id:t,type:"progress",data:e})});self.postMessage({id:t,type:"complete",data:n})}}catch(e){self.postMessage({id:t,type:"error",error:{message:e.message,stack:e.stack}})}},self.postMessage({type:"ready"})}}]);